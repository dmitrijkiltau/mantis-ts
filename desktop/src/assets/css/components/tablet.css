@layer components {
  .pip-tablet {
    @apply rounded-lg overflow-hidden relative;
    @apply border-[3px] border-primary-60;
    background: linear-gradient(135deg, var(--color-bg-tablet), var(--color-bg-tablet-alt));
    box-shadow: var(--shadow-glow-primary-strong), var(--shadow-inset-glow-strong);

    /* CRT scanlines overlay */
    &::before {
      content: "";
      @apply absolute inset-0 pointer-events-none z-10;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        var(--color-scanline) 2px,
        var(--color-scanline) 4px
      );
    }

    /* CRT screen curvature simulation */
    &::after {
      content: "";
      @apply absolute inset-0 pointer-events-none z-10 rounded-lg;
      background: radial-gradient(
        ellipse at center,
        transparent 60%,
        rgba(0, 0, 0, 0.15) 100%
      );
    }
  }

  .tablet-header {
    @apply flex items-center justify-between px-5 py-3 border-b-2;
    background: var(--color-primary-15);
    border-color: var(--color-primary-40);
  }

  .tablet-title {
    @apply flex items-center gap-2 text-sm font-bold tracking-wider text-terminal-primary;
    text-shadow: var(--shadow-text-primary);

    .title-icon {
      @apply inline-block;
      animation: rotate 4s linear infinite;
    }
  }

  @keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  .tablet-stats {
    @apply flex gap-4 text-xs;
  }

  .stat-item {
    @apply px-2 py-1 rounded text-terminal-primary border font-mono;
    background: var(--color-bg-black);
    border-color: var(--color-primary-30);
  }

  .tablet-tabs {
    @apply flex border-b-2;
    background: var(--color-bg-black-soft);
    border-color: var(--color-primary-30);
  }

  .tab-button {
    @apply flex-1 px-4 py-3 text-xs font-bold tracking-wider;
    @apply border-r border-r-primary-20 transition-all duration-200;
    @apply text-primary-50;

    &:last-child {
      @apply border-r-0;
    }

    &:hover {
      @apply bg-primary-10 text-primary-80;
    }

    &.active {
      @apply text-terminal-primary bg-primary-20;
      box-shadow: inset 0 -2px 0 var(--color-terminal-primary);
    }
  }

  .tablet-screen {
    @apply relative p-5 min-h-100 bg-bg-black;
  }

  .scan-line {
    @apply absolute left-0 right-0 h-0.5 pointer-events-none;
    background: linear-gradient(90deg, transparent, var(--color-primary-40), transparent);
    animation: scan 3s linear infinite;
  }

  @keyframes scan {
    from { top: 0; }
    to { top: 100%; }
  }

  .tablet-panel {
    @apply hidden overflow-y-auto max-h-120;

    &.active {
      @apply block;
      animation: panel-fade-in 0.3s ease-out;
    }
  }

  @keyframes panel-fade-in {
    from {
      opacity: 0;
      transform: translateX(-10px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .status-display {
    @apply flex flex-col gap-5;
  }

  .status-grid {
    @apply grid gap-3;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  }

  .status-card {
    @apply flex flex-col gap-2 px-4 py-3 rounded border-l-[3px];
    background: var(--color-status-neutral);
    border-color: var(--color-primary-50);
    box-shadow: var(--shadow-inset-glow);
  }

  .status-card[data-state='OPERATIONAL'],
  .status-card[data-state='COMPLETE'],
  .status-card[data-state='AWAITING_INPUT'],
  .status-card[data-state='ANSWER_GENERATED'] {
    background: var(--color-status-ok);
    border-color: var(--color-emerald-40);
  }

  .status-card[data-state='PROCESSING'],
  .status-card[data-state='ANALYZING'],
  .status-card[data-state='QUERY_RECEIVED'],
  .status-card[data-state='CONTRACT_VALIDATION'],
  .status-card[data-state^='TOOL_'] {
    background: var(--color-status-active);
    border-color: var(--color-cyan-50);
  }

  .status-card[data-state='FAILED'],
  .status-card[data-state='ERROR'],
  .status-card[data-state='EXCEPTION'],
  .status-card[data-state='UNHANDLED'] {
    background: var(--color-status-error);
    border-color: var(--color-status-error-border);
  }

  .status-card[data-state='NONE'] {
    background: var(--color-status-neutral);
    border-color: var(--color-primary-40);
  }

  .status-label {
    @apply text-xs font-bold tracking-wider min-w-30;
    color: var(--color-primary-70);
  }

  .status-value {
    @apply text-sm font-mono text-terminal-primary;
    text-shadow: var(--shadow-text-primary-soft);
  }

  .status-contracts {
    @apply flex flex-col gap-3;
  }

  .status-section-label {
    @apply text-[10px] font-semibold tracking-widest text-primary-60;
  }

  .status-section-header {
    @apply flex items-center justify-between gap-3;
  }

  .status-section-meta {
    @apply text-[10px] font-mono text-terminal-primary px-2 py-1;
    @apply bg-bg-black-soft rounded border border-primary-30;
  }

  .subsystem-groups {
    @apply flex flex-col gap-4;
  }

  .subsystem-group {
    @apply flex flex-col gap-3;
  }

  .subsystem-group-header {
    @apply flex flex-col gap-1;
  }

  .subsystem-group-title {
    @apply text-[11px] font-bold tracking-[0.3em] text-terminal-primary;
    text-shadow: var(--shadow-text-primary-soft);
  }

  .subsystem-group-subtitle {
    @apply text-[10px] font-mono text-primary-60;
  }

  .subsystem-module-grid {
    @apply grid gap-3;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  }

  .subsystem-module {
    @apply flex flex-col gap-2 p-3 rounded border;
    background: var(--color-bg-black-soft);
    border-color: var(--color-primary-20);
    box-shadow: var(--shadow-inset-glow);
  }

  .subsystem-module[data-state='ACTIVE'] {
    background: var(--color-status-ok);
    border-color: var(--color-emerald-40);
  }

  .subsystem-module[data-state='STANDBY'] {
    background: var(--color-amber-20);
    border-color: var(--color-amber-40);
  }

  .subsystem-module[data-state='IDLE'] {
    background: var(--color-status-neutral);
    border-color: var(--color-primary-40);
  }

  .subsystem-module[data-state='DEGRADED'] {
    background: var(--color-status-error);
    border-color: var(--color-status-error-border);
  }

  .subsystem-module[data-state='OFFLINE'] {
    background: var(--color-bg-black);
    border-color: var(--color-primary-15);
  }

  .subsystem-module-header {
    @apply flex items-center justify-between gap-2;
  }

  .subsystem-module-title {
    @apply flex items-center gap-2 text-xs font-bold tracking-wider text-terminal-primary;
  }

  .subsystem-module-lamp {
    @apply w-2 h-2 rounded-full border;
    background: var(--color-primary-30);
    border-color: var(--color-primary-50);
    box-shadow: var(--shadow-glow-primary-soft);
  }

  .subsystem-module-lamp[data-state='ACTIVE'] {
    background: var(--color-terminal-emerald);
    border-color: var(--color-emerald-40);
    box-shadow: var(--shadow-glow-primary-strong);
  }

  .subsystem-module-lamp[data-state='STANDBY'] {
    background: var(--color-terminal-amber);
    border-color: var(--color-amber-40);
    box-shadow: var(--shadow-glow-amber);
  }

  .subsystem-module-lamp[data-state='IDLE'] {
    background: var(--color-primary-40);
    border-color: var(--color-primary-60);
  }

  .subsystem-module-lamp[data-state='DEGRADED'] {
    background: var(--color-status-error-border);
    border-color: var(--color-status-error-border);
  }

  .subsystem-module-lamp[data-state='OFFLINE'] {
    background: var(--color-primary-20);
    border-color: var(--color-primary-30);
    box-shadow: none;
  }

  .subsystem-module-status {
    @apply text-[9px] font-bold tracking-[0.25em] uppercase px-2 py-0.5 rounded border;
    background: var(--color-bg-black-soft);
    border-color: var(--color-primary-20);
    color: var(--color-primary-70);
  }

  .subsystem-module-status[data-state='ACTIVE'] {
    color: var(--color-terminal-primary);
    border-color: var(--color-emerald-40);
  }

  .subsystem-module-status[data-state='STANDBY'] {
    color: var(--color-terminal-amber);
    border-color: var(--color-amber-40);
  }

  .subsystem-module-status[data-state='IDLE'] {
    color: var(--color-primary-70);
    border-color: var(--color-primary-30);
  }

  .subsystem-module-status[data-state='DEGRADED'] {
    color: var(--color-status-error-border);
    border-color: var(--color-status-error-border);
  }

  .subsystem-module-status[data-state='OFFLINE'] {
    color: var(--color-primary-50);
    border-color: var(--color-primary-20);
  }

  .subsystem-module-body {
    @apply flex flex-col gap-1;
  }

  .subsystem-module-row {
    @apply grid gap-2 text-[11px] font-mono;
    grid-template-columns: 84px 1fr;
  }

  .subsystem-module-label {
    @apply text-[9px] uppercase tracking-[0.3em] text-primary-60;
  }

  .subsystem-module-value {
    @apply text-terminal-primary;
    word-break: break-word;
  }

  .subsystem-module-link {
    @apply text-terminal-primary underline decoration-primary-40;
    text-underline-offset: 2px;

    &:hover {
      @apply text-terminal-cyan decoration-terminal-cyan;
    }
  }

  .subsystem-module-access {
    @apply inline-flex items-center px-1.5 py-0.5 rounded border text-[9px] font-bold tracking-widest uppercase;
    background: var(--color-bg-black-soft);
  }

  .subsystem-module-access[data-access='LOCKED'] {
    @apply text-terminal-cyan border-terminal-cyan;
  }

  .subsystem-module-access[data-access='OPEN'] {
    @apply text-terminal-primary border-primary-30;
  }

  .subsystem-module-load {
    @apply text-terminal-primary text-xs tracking-[0.3em] font-mono;
  }

  .subsystem-module-telemetry {
    @apply mt-1 pt-2 flex flex-col gap-1 text-[10px] font-mono text-primary-60 border-t;
    border-color: var(--color-primary-15);
  }

  .subsystem-placeholder {
    @apply text-xs text-primary-60 font-mono px-3 py-2 rounded border border-primary-20;
    background: var(--color-bg-black-soft);
  }

  .history-list {
    @apply flex flex-col gap-3 overflow-y-auto;
  }

  .history-entry {
    @apply rounded border overflow-hidden border-primary-30 bg-primary-8;
    box-shadow: var(--shadow-inset-glow);
  }

  .history-entry[open] {
    border-color: var(--color-primary-50);
    box-shadow: var(--shadow-glow-primary-soft), var(--shadow-inset-glow);
  }

  .history-summary {
    @apply flex items-center gap-3 px-4 py-3 cursor-pointer select-none;
    background: linear-gradient(90deg, var(--color-bg-black), var(--color-primary-10));
  }

  .history-summary::-webkit-details-marker {
    display: none;
  }

  .history-summary::marker {
    content: "";
  }

  .history-badge {
    @apply text-[10px] font-bold uppercase tracking-[0.25em] px-2 py-1 rounded border;
    @apply border-primary-40 text-terminal-cyan bg-primary-10;
  }

  .history-entry[data-kind='error'] .history-badge {
    @apply border-amber-40 text-terminal-amber bg-amber-20;
  }

  .history-title {
    @apply text-sm font-bold text-terminal-primary;
  }

  .history-question-snippet {
    @apply flex-1 min-w-0 text-xs text-primary-70 truncate;
  }

  .history-meta {
    @apply text-[11px] font-mono text-primary-60;
  }

  .history-body {
    @apply flex flex-col gap-3 px-4 py-3 bg-bg-black-soft border-t border-primary-20;
  }

  .history-section {
    @apply flex flex-col gap-2;
  }

  .history-section-label {
    @apply text-[10px] font-semibold tracking-widest text-primary-60;
  }

  .history-text {
    @apply text-sm text-terminal-primary font-mono whitespace-pre-wrap;
    word-break: break-word;
  }

  .history-evaluation {
    @apply flex flex-col gap-2;
    font-size: 0.75rem;
  }

  .history-evaluation-row {
    @apply flex items-center justify-between gap-3;
  }

  .history-evaluation-label {
    @apply text-[10px] uppercase tracking-widest text-primary-60;
  }

  .history-evaluation-score {
    @apply font-mono text-xs text-terminal-primary;
  }

  .history-evaluation-alert {
    @apply text-[10px] font-semibold text-terminal-amber;
  }

  .telemetry-panel {
    @apply flex flex-col gap-4 p-4 mt-2 border border-primary-20 rounded bg-primary-5;
  }

  .telemetry-header {
    @apply flex flex-col gap-1;
  }

  .telemetry-title {
    @apply text-sm font-semibold tracking-[0.3em] text-terminal-primary uppercase;
  }

  .telemetry-subtitle {
    @apply text-[11px] font-mono text-primary-60;
  }

  .telemetry-grid {
    @apply grid grid-cols-3 gap-3;
  }

  .telemetry-metric {
    @apply flex flex-col gap-1 p-3 border border-primary-20 rounded text-center bg-bg-terminal;
  }

  .telemetry-metric-label {
    @apply text-[9px] uppercase tracking-widest text-primary-70;
  }

  .telemetry-metric-value {
    @apply text-xl font-bold text-terminal-cyan;
  }

  .telemetry-averages,
  .telemetry-recent {
    @apply flex flex-col gap-2;
  }

  .telemetry-section-label {
    @apply text-[10px] font-semibold tracking-widest text-primary-60;
  }

  .telemetry-averages-list,
  .telemetry-recent-list {
    @apply flex flex-col gap-2;
  }

  .telemetry-averages-placeholder,
  .telemetry-recent-placeholder {
    @apply text-[10px] text-primary-60 font-mono;
  }

  .telemetry-average-row {
    @apply flex items-center justify-between text-[12px] text-terminal-primary font-mono;
  }

  .telemetry-recent-item {
    @apply flex flex-col gap-1 p-2 border border-primary-15 rounded bg-bg-terminal;
  }

  .telemetry-recent-time {
    @apply text-[9px] uppercase tracking-[0.3em] text-primary-60;
  }

  .telemetry-recent-label {
    @apply text-[11px] font-semibold text-terminal-primary;
  }

  .telemetry-recent-alert {
    @apply text-[10px] font-semibold text-terminal-amber;
  }

  .telemetry-recent-detail {
    @apply text-[10px] font-mono text-primary-60;
  }

  .history-bubble-shell {
    @apply p-3 rounded border border-primary-30 bg-bg-terminal max-w-none;
    box-shadow: var(--shadow-inset-glow);
    max-height: none;
    overflow: visible;
  }

  .history-bubble-shell .bubble-content {
    @apply pr-0;
    max-height: none;
    overflow: visible;
  }

  .logs-console {
    @apply flex flex-col gap-1 max-h-100 overflow-y-auto text-xs font-mono;
  }

  .log-entry {
    @apply py-1 px-2 text-primary-80 border-b border-primary-10;

    &:hover {
      @apply bg-primary-5;
    }
  }
}
