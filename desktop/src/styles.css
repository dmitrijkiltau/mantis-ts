@import "./assets/css/theme.css";

@layer base {
  * {
    @apply box-border;
  }

  body {
    @apply relative isolate min-h-screen font-mono antialiased text-terminal-primary;
    background: 
      radial-gradient(ellipse at top left, var(--color-gradient-top), transparent 50%),
      radial-gradient(ellipse at bottom right, var(--color-gradient-bottom), transparent 50%),
      var(--color-bg-dark);

    &::before {
      content: "";
      @apply pointer-events-none fixed inset-0 z-0 opacity-5;
      background-image: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        var(--color-scanline) 2px,
        var(--color-scanline) 4px
      );
      animation: scanlines 8s linear infinite;
    }
  }

  @keyframes scanlines {
    from { transform: translateY(0); }
    to { transform: translateY(4px); }
  }

  button {
    @apply inline-flex items-center justify-center px-6 py-2 text-sm font-semibold;
    @apply cursor-pointer transition-all duration-200 ease-out font-mono;

    &:hover {
      @apply brightness-125;
    }

    &:active {
      @apply scale-95;
    }

    &:disabled {
      @apply cursor-not-allowed opacity-40;
    }
  }
}

@layer components {
  .app-shell {
    @apply relative min-h-screen w-full max-w-4xl mx-auto px-4 py-8 z-10;
    @apply flex flex-col justify-center gap-8;
  }

  .avatar-zone {
    @apply relative flex flex-col items-center gap-4;
  }

  :has(.avatar-canvas:hover, .input-terminal:hover, .pip-tablet:active) .assistant-avatar-svg {
    @apply scale-110;
  }

  .avatar-canvas {
    @apply w-48 h-48 grid place-items-center;
    filter: var(--shadow-glow-primary);

    .assistant-avatar-svg {
      @apply transition-transform duration-500 ease-out;
    }
  }

  .speech-bubble {
    @apply relative rounded-xl p-6 max-w-2xl bg-bg-bubble border-2 border-terminal-primary;
    box-shadow: var(--shadow-glow-primary-soft), var(--shadow-inset-glow);
    animation: bubble-appear 0.4s ease-out;

    &.hidden {
      @apply hidden;
    }
  }

  .bubble-content {
    @apply text-base leading-relaxed text-terminal-primary font-mono;
    white-space: pre-wrap;
    word-wrap: break-word;

    p {
      margin: 0.5em 0;

      &:first-child {
        margin-top: 0;
      }

      &:last-child {
        margin-bottom: 0;
      }
    }

    code {
      background: rgba(0, 255, 136, 0.1);
      padding: 0.125em 0.25em;
      border-radius: 3px;
    }

    pre {
      background: rgba(0, 0, 0, 0.3);
      padding: 0.75em;
      border-radius: 4px;
      overflow-x: auto;
      margin: 0.5em 0;

      code {
        background: none;
        padding: 0;
      }
    }

    ul, ol {
      margin: 0.5em 0;
      padding-left: 1.5em;
    }

    strong {
      font-weight: 700;
      color: var(--color-primary);
    }

    em {
      font-style: italic;
    }

    a {
      color: var(--color-primary);
      text-decoration: underline;

      &:hover {
        color: var(--color-primary-70);
      }
    }
  }

  .bubble-tail {
    @apply w-0 h-0 absolute -top-5 left-1/2 transform -translate-x-1/2 rotate-180;
    @apply border-l-15 border-r-15 border-b-20 border-b-terminal-primary;
    filter: drop-shadow(0 2px 4px var(--color-primary-30));
  }

  @keyframes bubble-appear {
    from {
      opacity: 0;
      transform: translateY(-10px) scale(0.95);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .input-terminal {
    @apply rounded-lg bg-bg-terminal border-2 border-primary-40 overflow-hidden;
    box-shadow: var(--shadow-glow-primary-soft), inset 0 1px 0 var(--color-primary-10);
  }

  .terminal-header {
    @apply flex items-center justify-between px-4 py-2;
    background: var(--color-primary-10);
    border-bottom: 1px solid var(--color-primary-30);
  }

  .terminal-title {
    @apply text-xs font-bold tracking-wider text-terminal-primary;
    text-shadow: var(--shadow-text-primary);
  }

  .status-indicator {
    @apply text-xs px-3 py-1 rounded text-terminal-primary;
    @apply border;
    background: var(--color-primary-20);
    border-color: var(--color-primary-40);
    animation: pulse 2s ease-in-out infinite;

    &[data-mood='listening'] {
      @apply text-terminal-cyan;
      background: var(--color-cyan-20);
      border-color: var(--color-cyan-40);
    }

    &[data-mood='thinking'] {
      @apply text-terminal-amber;
      background: var(--color-amber-20);
      border-color: var(--color-amber-40);
    }

    &[data-mood='speaking'] {
      @apply text-terminal-emerald;
      background: var(--color-emerald-20);
      border-color: var(--color-emerald-40);
    }
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }

  #prompt-form {
    @apply grid grid-cols-1 grid-rows-[auto_1fr] gap-0;
  }

  .terminal-input {
    @apply col-start-1 row-start-2;
    @apply w-full min-h-25 px-4 pt-4 pb-14 bg-transparent text-terminal-primary;
    @apply border-none outline-none font-mono resize-y;

    &::placeholder {
      @apply text-primary-40;
    }

    &:focus {
      @apply bg-primary-5;
    }
  }

  .terminal-button {
    @apply col-start-1 row-start-2  self-end justify-self-end;
    @apply mx-4 mb-4 px-6 py-2 bg-primary-15 font-bold;
    @apply text-terminal-primary border-2 border-terminal-primary;
    @apply transition-all duration-200 ease-out;
    letter-spacing: 0.1em;

    .button-bracket {
      @apply inline-block transition-transform;
    }

    &:hover {
      @apply bg-primary-20 shadow-glow-primary-soft;

      .button-bracket:first-child {
        @apply -translate-x-3;
      }

      .button-bracket:last-child {
        @apply translate-x-3;
      }
    }

    &:disabled {
      @apply opacity-30 cursor-not-allowed;
    }
  }

  .pip-tablet {
    @apply rounded-lg overflow-hidden relative;
    @apply border-[3px] border-primary-60;
    background: linear-gradient(135deg, var(--color-bg-tablet), var(--color-bg-tablet-alt));
    box-shadow: var(--shadow-glow-primary-strong), var(--shadow-inset-glow-strong);

    &::before {
      content: "";
      @apply absolute inset-0 pointer-events-none;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        var(--color-scanline) 2px,
        var(--color-scanline) 4px
      );
    }
  }

  .tablet-header {
    @apply flex items-center justify-between px-5 py-3 border-b-2;
    background: var(--color-primary-15);
    border-color: var(--color-primary-40);
  }

  .tablet-title {
    @apply flex items-center gap-2 text-sm font-bold tracking-wider text-terminal-primary;
    text-shadow: var(--shadow-text-primary);

    .title-icon {
      @apply inline-block;
      animation: rotate 4s linear infinite;
    }
  }

  @keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  .tablet-stats {
    @apply flex gap-4 text-xs;
  }

  .stat-item {
    @apply px-2 py-1 rounded text-terminal-primary border font-mono;
    background: var(--color-bg-black);
    border-color: var(--color-primary-30);
  }

  .tablet-tabs {
    @apply flex border-b-2;
    background: var(--color-bg-black-soft);
    border-color: var(--color-primary-30);
  }

  .tab-button {
    @apply flex-1 px-4 py-3 text-xs font-bold tracking-wider;
    @apply border-r transition-all duration-200;
    color: var(--color-primary-50);
    border-color: var(--color-primary-20);

    &:last-child {
      @apply border-r-0;
    }

    &:hover {
      background: var(--color-primary-10);
      color: var(--color-primary-80);
    }

    &.active {
      @apply text-terminal-primary;
      background: var(--color-primary-20);
      box-shadow: inset 0 -2px 0 var(--color-terminal-primary);
    }
  }

  .tablet-screen {
    @apply relative p-5 min-h-[400px];
    background: var(--color-bg-black);
  }

  .scan-line {
    @apply absolute left-0 right-0 h-[2px] pointer-events-none;
    background: linear-gradient(90deg, transparent, var(--color-primary-40), transparent);
    animation: scan 3s linear infinite;
  }

  @keyframes scan {
    from { top: 0; }
    to { top: 100%; }
  }

  .tablet-panel {
    @apply hidden;

    &.active {
      @apply block;
      animation: panel-fade-in 0.3s ease-out;
    }
  }

  @keyframes panel-fade-in {
    from {
      opacity: 0;
      transform: translateX(-10px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .status-display {
    @apply flex flex-col gap-3;
  }

  .status-row {
    @apply flex items-center gap-3 px-4 py-3 rounded border-l-[3px];
    background: var(--color-primary-5);
    border-color: var(--color-primary-50);
  }

  .status-label {
    @apply text-xs font-bold tracking-wider min-w-[120px];
    color: var(--color-primary-70);
  }

  .status-value {
    @apply text-sm font-mono text-terminal-primary;
    text-shadow: var(--shadow-text-primary-soft);
  }

  .history-list {
    @apply flex flex-col gap-3 max-h-[400px] overflow-y-auto;

    &::-webkit-scrollbar {
      @apply w-2;
    }

    &::-webkit-scrollbar-track {
      background: var(--color-bg-black-soft);
    }

    &::-webkit-scrollbar-thumb {
      @apply rounded;
      background: var(--color-primary-40);

      &:hover {
        background: var(--color-primary-60);
      }
    }
  }

  .answer-card {
    @apply p-4 rounded border;
    background: var(--color-primary-8);
    border-color: var(--color-primary-30);

    h3 {
      @apply text-sm font-bold mb-2 text-terminal-cyan;
      text-shadow: var(--shadow-glow-cyan);
    }

    pre {
      @apply text-xs whitespace-pre-wrap mt-2 p-2 rounded text-terminal-primary border;
      background: var(--color-bg-black);
      border-color: var(--color-primary-20);
    }

    p {
      @apply text-xs mt-2;
      color: var(--color-primary-70);
    }
  }

  .logs-console {
    @apply flex flex-col gap-1 max-h-[400px] overflow-y-auto text-xs font-mono;

    &::-webkit-scrollbar {
      @apply w-2;
    }

    &::-webkit-scrollbar-track {
      background: var(--color-bg-black-soft);
    }

    &::-webkit-scrollbar-thumb {
      @apply rounded;
      background: var(--color-primary-40);
    }
  }

  .log-entry {
    @apply py-1 px-2 border-b;
    color: var(--color-primary-80);
    border-color: var(--color-primary-10);

    &:hover {
      background: var(--color-primary-5);
    }
  }

  .tool-panel {
    @apply flex flex-col gap-4;
  }

  .tool-grid {
    @apply grid gap-4;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  }

  .tool-card {
    @apply p-4 rounded border flex flex-col gap-4;
    background: var(--color-bg-terminal);
    border-color: var(--color-primary-30);
    box-shadow: var(--shadow-glow-primary-soft), inset 0 1px 0 var(--color-primary-10);
  }

  .tool-card-header {
    @apply flex flex-col gap-1;
  }

  .tool-label {
    @apply text-sm font-bold tracking-wider text-terminal-primary;
  }

  .tool-subtext {
    @apply text-xs text-primary-70;
  }

  .tool-form {
    @apply flex flex-col gap-3;
  }

  .field {
    @apply flex flex-col gap-2;
  }

  .field-grid {
    @apply grid gap-3;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  }

  .field-label {
    @apply text-xs font-bold uppercase tracking-widest text-primary-70;
  }

  .field-input {
    @apply w-full px-3 py-2 rounded border text-sm font-mono;
    background: var(--color-bg-black);
    border-color: var(--color-primary-30);
    color: var(--color-terminal-primary);

    &:focus {
      outline: 2px solid var(--color-primary-40);
      box-shadow: var(--shadow-glow-primary-soft);
    }
  }

  .switches {
    @apply flex gap-4 flex-wrap;
  }

  .switch {
    @apply inline-flex items-center gap-2 text-sm text-terminal-primary;
  }

  .terminal-button.slim {
    @apply w-full justify-center text-xs;
  }

  .tool-results {
    @apply flex flex-col gap-3 max-h-[320px] overflow-y-auto;
  }

  .tool-placeholder {
    @apply text-xs text-primary-70 py-3 px-4 rounded border border-dashed;
    border-color: var(--color-primary-30);
    background: var(--color-primary-5);
  }

  .tool-result-card {
    @apply p-3 rounded border flex flex-col gap-2;
    background: var(--color-primary-8);
    border-color: var(--color-primary-30);
  }

  .tool-result-title {
    @apply text-xs font-bold uppercase tracking-widest text-terminal-cyan;
  }

  .tool-result-meta {
    @apply text-[11px] text-primary-70;
  }

  .tool-result-card pre {
    @apply text-xs whitespace-pre-wrap p-2 rounded border;
    background: var(--color-bg-black);
    border-color: var(--color-primary-20);
    color: var(--color-terminal-primary);
  }
}
